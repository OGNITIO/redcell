# Author: Lucien Zagabe <rz@ognitio.com>
#
# Fluentd tasks for deployment.
#

- name: Create fluentd conf folder
  file: path=/tmp/fluentd/conf state=directory mode=0755 recurse=yes

- name: Copy Dockerfile
  copy: src=Dockerfile dest=/tmp/fluentd

- name: Copy launch script (run.sh)
  copy: src=conf/fluentd.conf dest=/tmp/fluentd

- name: Copy fluentd configuration
  template: src=fluentd.conf.j2 dest=/tmp/fluentd/conf/fluentd.conf

- name: Building fluentd docker image
  command: docker build -t fluentd-es /tmp/fluentd

- name: Run docker command
  command: docker run --restart=always -d -v /var/log:/var/log:ro fluentd-es
