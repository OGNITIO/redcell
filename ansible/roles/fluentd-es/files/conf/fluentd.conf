<source>
  type tail
  path /var/lib/docker/containers/*/*-json.log
  pos_file /var/lib/fluentd/containers.log.pos
  time_format %Y-%m-%d %H:%M:%S
  tag containers.*
  format json
  read_from_head true
</source>

{% if host in groups['marathon'] %}
<source>
  type tail
  path /var/log/marathon/marathon.log
  format syslog
  pos_file /var/lib/fluentd/marathon.log.pos
  tag marathon
</source>
{% endif %}

{% if host in groups['zookeeper'] %}
<source>
  type tail
  path /var/log/zookeeper/zookeeper.log
  format none
  pos_file /var/lib/fluentd/zookeeper.log.pos
  tag zookeeper
</source>
{% endif %}

{% if host in groups['mesos-master'] %}
<source>
  type tail
  path /var/log/mesos/mesos-master.log
  format syslog
  pos_file /var/lib/fluentd/mesos-master.log.pos
  tag mesos-master
</source>
{% endif %}

{% if host in groups['mesos-slave'] %}
<source>
  type tail
  path /var/log/mesos/mesos-slave.log
  format syslog
  pos_file /var/lib/fluentd/mesos-slave.log.pos
  tag mesos-slave
</source>
{% endif %}

<match **>
  type elasticsearch
  host elasticsearch.marathon.slave.mesos
  port 31020
  logstash_format true
  buffer_chunk_limit 512K
  buffer_queue_limit 128
  flush_interval 5s
  max_retry_wait 300
  include_tag_key true
  disable_retry_limit
</match>
